const paises={mexico:{nombre:"México",url:"https://raw.githubusercontent.com/josafra/tv/main/mexico.m3u"},guatemala:{nombre:"Guatemala",url:"https://raw.githubusercontent.com/josafra/tv/main/guatemala.m3u"},elsalvador:{nombre:"El Salvador",url:"https://raw.githubusercontent.com/josafra/tv/main/elsalvador.m3u"},honduras:{nombre:"Honduras",url:"https://raw.githubusercontent.com/josafra/tv/main/honduras.m3u"},nicaragua:{nombre:"Nicaragua",url:"https://raw.githubusercontent.com/josafra/tv/main/nicaragua.m3u"},costarica:{nombre:"Costa Rica",url:"https://raw.githubusercontent.com/josafra/tv/main/costarica.m3u"},panama:{nombre:"Panamá",url:"https://raw.githubusercontent.com/josafra/tv/main/panama.m3u"},cuba:{nombre:"Cuba",url:"https://raw.githubusercontent.com/josafra/tv/main/cuba.m3u"},republicadominicana:{nombre:"República Dominicana",url:"https://raw.githubusercontent.com/josafra/tv/main/republicadominicana.m3u"},puertorico:{nombre:"Puerto Rico",url:"https://raw.githubusercontent.com/josafra/tv/main/puertorico.m3u"},venezuela:{nombre:"Venezuela",url:"https://raw.githubusercontent.com/josafra/tv/main/venezuela.m3u"},colombia:{nombre:"Colombia",url:"https://raw.githubusercontent.com/josafra/tv/main/colombia.m3u"},ecuador:{nombre:"Ecuador",url:"https://raw.githubusercontent.com/josafra/tv/main/ecuador.m3u"},peru:{nombre:"Perú",url:"https://raw.githubusercontent.com/josafra/tv/main/peru.m3u"},bolivia:{nombre:"Bolivia",url:"https://raw.githubusercontent.com/josafra/tv/main/bolivia.m3u"},paraguay:{nombre:"Paraguay",url:"https://raw.githubusercontent.com/josafra/tv/main/paraguay.m3u"},chile:{nombre:"Chile",url:"https://raw.githubusercontent.com/josafra/tv/main/chile.m3u"},argentina:{nombre:"Argentina",url:"https://raw.githubusercontent.com/josafra/tv/main/Argentina.m3u"},uruguay:{nombre:"Uruguay",url:"https://raw.githubusercontent.com/josafra/tv/main/uruguay.m3u"},espana:{nombre:"España",url:"https://raw.githubusercontent.com/josafra/tv/main/espana.m3u"},deportes:{nombre:"Deportes",url:"https://raw.githubusercontent.com/josafra/tv/main/deportes.m3u"},noticias:{nombre:"Noticias",url:"https://raw.githubusercontent.com/josafra/tv/main/noticias.m3u"},musica:{nombre:"Música",url:"https://raw.githubusercontent.com/josafra/tv/main/musica.m3u"},peliculas:{nombre:"Películas",url:"https://raw.githubusercontent.com/josafra/tv/main/peliculas.m3u"},series:{nombre:"Series",url:"https://raw.githubusercontent.com/josafra/tv/main/series.m3u"},infantil:{nombre:"Infantil",url:"https://raw.githubusercontent.com/josafra/tv/main/infantil.m3u"},documentales:{nombre:"Documentales",url:"https://raw.githubusercontent.com/josafra/tv/main/documentales.m3u"},entretenimiento:{nombre:"Entretenimiento",url:"https://raw.githubusercontent.com/josafra/tv/main/entretenimiento.m3u"},cultura:{nombre:"Cultura",url:"https://raw.githubusercontent.com/josafra/tv/main/cultura.m3u"},religion:{nombre:"Religión",url:"https://raw.githubusercontent.com/josafra/tv/main/religion.m3u"},cocina:{nombre:"Cocina",url:"https://raw.githubusercontent.com/josafra/tv/main/cocina.m3u"},viajes:{nombre:"Viajes",url:"https://raw.githubusercontent.com/josafra/tv/main/viajes.m3u"},tecnologia:{nombre:"Tecnología",url:"https://raw.githubusercontent.com/josafra/tv/main/tecnologia.m3u"},salud:{nombre:"Salud",url:"https://raw.githubusercontent.com/josafra/tv/main/salud.m3u"},naturaleza:{nombre:"Naturaleza",url:"https://raw.githubusercontent.com/josafra/tv/main/naturaleza.m3u"},ciencia:{nombre:"Ciencia",url:"https://raw.githubusercontent.com/josafra/tv/main/ciencia.m3u"},historia:{nombre:"Historia",url:"https://raw.githubusercontent.com/josafra/tv/main/historia.m3u"},educacion:{nombre:"Educación",url:"https://raw.githubusercontent.com/josafra/tv/main/educacion.m3u"},variedades:{nombre:"Variedades",url:"https://raw.githubusercontent.com/josafra/tv/main/variedades.m3u"}},video=document.getElementById("video");video.controls=!1;const overlay=document.getElementById("videoOverlay"),welcomeOverlay=document.getElementById("welcomeOverlay"),loadingChannelName=document.getElementById("loadingChannelName"),playlistDiv=document.getElementById("playlist"),currentChannelLabel=document.getElementById("currentChannel"),initialMessage=document.getElementById("initialMessage"),countryTitle=document.getElementById("countryTitle"),welcomeText=document.getElementById("welcomeText");let hls,currentSelectedIndex=0,channelButtons=[],currentPlayingIndex=-1,currentCountry="",allChannels=[],showingFavorites=!1;function getFavorites(){const e=localStorage.getItem("tv_favorites");return e?JSON.parse(e):[]}function saveFavorites(e){localStorage.setItem("tv_favorites",JSON.stringify(e))}function isFavorite(e,t){return getFavorites().some(n=>n.name===e&&n.url===t)}function toggleFavorite(e,t){let n=getFavorites();const a=n.findIndex(n=>n.name===e&&n.url===t);a>=0?n.splice(a,1):n.push({name:e,url:t,country:currentCountry}),saveFavorites(n),showingFavorites?displayFavorites():updateFavoriteIcons()}function updateFavoriteIcons(){channelButtons.forEach(e=>{const t=e.textContent.replace("⭐ ","").trim();isFavorite(t,e.getAttribute("data-url"))?e.textContent.startsWith("⭐")||(e.textContent="⭐ "+t):e.textContent=e.textContent.replace("⭐ ","")})}function displayFavorites(){const e=getFavorites();if(playlistDiv.innerHTML='<div class="section-title">⭐ Favoritos</div>',0===e.length)return playlistDiv.innerHTML+='<p style="color: #ff6b6b; text-align: center; padding: 20px;">No tienes favoritos<br><br>Presiona "F" en cualquier canal para agregarlo</p>',void(channelButtons=[]);channelButtons=[],e.forEach((e,t)=>{const n=document.createElement("button");n.textContent="⭐ "+e.name,n.className="channel",n.setAttribute("tabindex","0"),n.setAttribute("data-url",e.url),n.onclick=()=>{handleChannelAction(channelButtons.indexOf(n))},playlistDiv.appendChild(n),channelButtons.push(n)}),channelButtons.length>0&&(currentSelectedIndex=0,channelButtons[0].classList.add("selected"),channelButtons[0].focus()),showingFavorites=!0,countryTitle.textContent="⭐ Favoritos"}function getCurrentCountry(){const e=new URLSearchParams(window.location.search).get("pais");return e?e.toLowerCase():"mexico"}async function loadM3U(){currentCountry=getCurrentCountry();const e=paises[currentCountry];if(!e)return playlistDiv.innerHTML='<p style="color: #ff6b6b;">País/Categoría no encontrado</p>',void welcomeOverlay.classList.add("hidden");countryTitle.textContent=e.nombre,welcomeText.textContent="TV "+e.nombre,document.title="Reproductor M3U8 - "+e.nombre;try{const t="?t="+Date.now(),n=await fetch(e.url+t);if(!n.ok)throw new Error("Error al cargar el archivo M3U");const a=(await n.text()).trim().split("\n");playlistDiv.innerHTML='<div class="section-title">'+e.nombre+"</div>",allChannels=[],channelButtons=[];for(let e=0;e<a.length;e++)if(a[e].startsWith("#EXTINF")){const t=a[e].split(",")[1].trim(),n=a[e+1].trim();if(n&&!n.startsWith("#")){allChannels.push({name:t,url:n});const e=document.createElement("button"),a=isFavorite(t,n)?"⭐ "+t:t;e.textContent=a,e.className="channel",e.setAttribute("tabindex","0"),e.setAttribute("data-url",n),e.onclick=()=>{handleChannelAction(channelButtons.indexOf(e))},playlistDiv.appendChild(e),channelButtons.push(e)}}channelButtons.length>0?(channelButtons[0].classList.add("selected"),channelButtons[0].focus()):playlistDiv.innerHTML+='<p style="color: #ff6b6b;">No se encontraron canales</p>',showingFavorites=!1,setTimeout(()=>{welcomeOverlay.classList.add("hidden")},2e3)}catch(e){console.error("Error:",e),playlistDiv.innerHTML+='<p style="color: #ff6b6b;">Error: '+e.message+"</p>",welcomeOverlay.classList.add("hidden")}}function playStream(e,t,n){hls&&hls.destroy();const a=t.replace("⭐ ","");if(loadingChannelName.textContent=a,overlay.style.opacity="1",overlay.style.pointerEvents="auto",welcomeOverlay.classList.add("hidden"),Hls.isSupported())hls=new Hls,hls.loadSource(e),hls.attachMedia(video),hls.on(Hls.Events.MANIFEST_PARSED,function(){video.play()});else{if(!video.canPlayType("application/vnd.apple.mpegurl"))return alert("Tu navegador no soporta HLS."),overlay.style.opacity="0",void(overlay.style.pointerEvents="none");video.src=e,video.addEventListener("loadedmetadata",function(){video.play()})}video.addEventListener("playing",()=>{overlay.style.opacity="0",overlay.style.pointerEvents="none"},{once:!0}),currentChannelLabel.textContent=a,initialMessage.style.display="none",currentPlayingIndex>=0&&channelButtons[currentPlayingIndex].classList.remove("playing"),currentPlayingIndex=n,channelButtons[currentPlayingIndex].classList.add("playing")}function toggleFullscreen(){video.requestFullscreen?video.requestFullscreen():video.webkitRequestFullscreen?video.webkitRequestFullscreen():video.msRequestFullscreen&&video.msRequestFullscreen()}function selectChannel(e){if(e<0||e>=channelButtons.length)return;channelButtons[currentSelectedIndex].classList.remove("selected"),currentSelectedIndex=e;const t=channelButtons[currentSelectedIndex];t.classList.add("selected"),t.focus(),t.scrollIntoView({behavior:"smooth",block:"center"})}function handleChannelAction(e){if(!(e<0||e>=channelButtons.length))if(selectChannel(e),currentPlayingIndex===e)toggleFullscreen();else{const t=channelButtons[currentSelectedIndex];playStream(t.getAttribute("data-url"),t.textContent,e)}}document.addEventListener("keydown",function(e){switch(e.key){case"ArrowUp":e.preventDefault(),selectChannel(currentSelectedIndex-1);break;case"ArrowDown":e.preventDefault(),selectChannel(currentSelectedIndex+1);break;case"Enter":case" ":e.preventDefault(),handleChannelAction(currentSelectedIndex);break;case"f":case"F":if(e.preventDefault(),channelButtons.length>0&&currentSelectedIndex>=0){const e=channelButtons[currentSelectedIndex];toggleFavorite(e.textContent.replace("⭐ ","").trim(),e.getAttribute("data-url"))}break;case"s":case"S":e.preventDefault(),showingFavorites?loadM3U():displayFavorites()}}),channelButtons.forEach((e,t)=>{e.addEventListener("focus",()=>{selectChannel(t)})}),loadM3U();